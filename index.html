<!doctype html>
<style>
@font-face {
  font-family: 'Apercu';
  src: url("https://static-sg.zacdn.com/fonts/apercu/apercu_regular-webfont.eot");
  src: url("https://static-sg.zacdn.com/fonts/apercu/apercu_regular-webfont.eot?#iefix") format("embedded-opentype"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_regular-webfont.woff2") format("woff2"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_regular-webfont.woff") format("woff"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_regular-webfont.ttf") format("truetype"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_regular-webfont.svg#apercuregular") format("svg");
  font-weight: 400;
  font-style: normal;
}
@font-face {
  font-family: 'Apercu';
  src: url("https://static-sg.zacdn.com/fonts/apercu/apercu_bold-webfont.eot");
  src: url("https://static-sg.zacdn.com/fonts/apercu/apercu_bold-webfont.eot?#iefix") format("embedded-opentype"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_bold-webfont.woff2") format("woff2"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_bold-webfont.woff") format("woff"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_bold-webfont.ttf") format("truetype"), url("https://static-sg.zacdn.com/fonts/apercu/apercu_bold-webfont.svg#apercubold") format("svg");
  font-weight: 700;
  font-style: normal;
}
body {
    background: #000;
    font-family: Apercu,Arial,Helvetica;
}
.container {
    color: #FFF;
    width: 100%;
    height: 100%;
    display: flex;
    position: fixed;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    font-size: 4.0vh;
}
.comment.long-text {
    font-size: 5.0vh;
}
.comment {
    text-align: center;
    font-size: 10.0vh;
}
.country {
    font-size: 4.0vh;
}
</style>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Voice of the Customer</title>
  </head>
  <body>
    <div class="container">
      <span>Voice of the Customer</span>
      <p id="comment" class="comment"></p>
      <p id="country" class="country"></p>
    </div>
  </body>
</html>
<script type="text/javascript" src="index.json"></script>
<script>
    function getRandomInt(max) {
      return Math.floor(Math.random() * Math.floor(max));
    }
    function getCommentText(comments, counter) {
      return '"' + comments[counter][0] + '"'
    }
    function getCountryText(comments, counter) {
      return comments[counter][1]
    }
    function setText(commentText, countryText) {
        var comment = document.getElementById('comment');
        var country = document.getElementById('country');
        comment.textContent = commentText
        country.textContent = countryText
        if (commentText.length > maxLength) {
            comment.classList.add('long-text');
        } else {
            comment.classList.remove('long-text');
        }
    }
    function getCountryTexts(comments, country) {
        var countryTexts = [];
        var hasFound = false;
        var numberOfComments = comments.length;
        for (var i = 0; i < numberOfComments; ++i) {
            var textCountry = comments[i][1];
            if (textCountry == country) {
                hasFound = true;
                countryTexts.push(comments[i]);
            } else if (hasFound) {
                // Assuming all countries comments stay together
                break;
            }
        }

        return countryTexts;
    }

    function getCountryParam() {
        var countries = {
          'sg': 'Singapore',
          'ph': 'Philippines',
          'my': 'Malaysia',
          'hk': 'Hong Kong',
          'tw': 'Taiwan',
          'id': 'Indonesia'
        };
        params = new URL(location.href).searchParams;
        raw_country = params.get('country');

        return typeof(countries[raw_country]) == undefined ? '' : countries[raw_country];
    }

    var timeToWait = 10000;
    var maxLength = 200; // should allow for 5 line with 40 characters per line
    var comments = comments || [];
    var countryParam = getCountryParam();

    console.log(countryParam);
    if (countryParam) {
      var comments = getCountryTexts(comments, countryParam);
    }
    console.log(comments, comments.length);
    var comment = document.getElementById('comment');
    var country = document.getElementById('country');
    var numberOfComments = comments.length;

    if (numberOfComments) {
      var counter = getRandomInt(numberOfComments);
      setText(getCommentText(comments, counter), getCountryText(comments, counter))
      setInterval(function() {
          counter = (counter + 1) % comments.length;
          setText(getCommentText(comments, counter), getCountryText(comments, counter))
      }, timeToWait);
    }
</script>
